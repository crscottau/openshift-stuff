# Central restore

## Backup

Restore requires a backup of the Central DB taken either 

- from the CLI using roxctl
- downloaded from a GUI initiated backup to S3

### roxctl method

Generate an *admin* API token from the Central UI and save to a file.

echo XXXXXXXX > rox-api-token

Backup:
`roxctl central backup --endpoint central-central.apps.87r6h.dynamic.redhatworkshops.io:443 --token-file rox-api-token`

This includes everything needed to restore Central, including certificates.

**TO BE TESTED**

### GUI method

Also requires a backup of the TLS secrets generated by Central, and rotated yearly.

`oc apply -f acs-tls-backup.yaml`

## Restoration

Restore the latest scheduled backup of the secrets:
`oc apply f acs-tls-restore.yaml`

Ensure the existing central DB PVC is deleted (or at least the database is deleted)

Create the new Central custom resource

Generate an *admin* API token from the Central UI and save to a file.

echo XXXXXXXX > rox-api-token

Restore the latest Central DB backup
`roxctl central db restore --endpoint central-central.apps.87r6h.dynamic.redhatworkshops.io:443 --token-file rox-api-token backup_2025-03-27T00_00_00.zip`
